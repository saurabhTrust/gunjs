<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decentralized Messenger</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        function getQueryParam(paramName) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(paramName);
        }
        function loadPlatformCSS() {
            const platform = getQueryParam('platform');
            const linkElement = document.createElement('link');
            linkElement.rel = 'stylesheet';
            linkElement.type = 'text/css';
            if (platform && platform.includes('tchatplatform1090')) {
                linkElement.href = '/styletrus.css';
            } else {
                linkElement.href = '/stylesdtak.css';
            }
            document.head.appendChild(linkElement);
        }
        loadPlatformCSS();
        setTimeout(() => {
            const splashScreen = document.getElementById('splashScreen');
            splashScreen.classList.add('hidden');
            setTimeout(() => {
                splashScreen.remove();
            }, 1000);
        }, 5000);
    </script>
</head>
<body>
    <div class="splash-screen" id="splashScreen">
        <div class="splash-logo">
            <img src="./images/logobg1.png" class="dtakIcon">
            <img src="./images/logoblue.png" class="trusIcon">
        </div>
        <div class="splash-title">
            <p>TrustGrid's</p> 
            <p>Decentralized</p> 
            <p>ConnectHub</p>
        </div>
        <div class="splash-features">
            <div class="feature-item">
                <i class="fas fa-lock"></i>
                End-To-End Encrypted
            </div>
            <div class="feature-item">
                <i class="fas fa-network-wired"></i>
                Secure Decentralized Network
            </div>
            <!-- <div class="feature-item">
                <i class="fas fa-shield-alt"></i>
                Privacy First
            </div> -->
        </div>
        <div class="powered-by">Powered By TrustGridâ„¢</div>
    </div>
    <div id="app">
        <!-- Main Interface -->
        <div class="main-screen">
            <!-- Navigation Tabs -->
            <div class="tab-container">
                <div class="tab active" onclick="switchTab('contacts')">Contacts</div>
                <div class="tab" onclick="switchTab('streams')">Streams</div>
            </div>

            <!-- Search Box -->
            <input type="text" class="search-box" placeholder="Search Contacts">

            <!-- Contacts List -->
            <div id="contactsList" class="list-container active">
                <!-- Contacts will be populated here -->
            </div>

            <!-- Streams Grid -->
            <div id="streamsList" class="list-container">
                <div class="streams-grid">
                    <!-- Streams will be populated here -->
                </div>
            </div>

            <!-- Add Button -->
            <button class="add-button" onclick="handleAddButton()">+</button>
        </div>

        <!-- Chat/Stream Interface -->
        <div class="chat-screen" id="chatScreen">
            <div class="chat-header">
                <button class="back-button" onclick="goBack()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="chat-title" id="chatTitle"></div>
                <div class="header-actions">
                    <!-- Will be populated based on context -->
                </div>
            </div>

            <div class="messages" id="messages">
                <!-- Messages will be populated here -->
            </div>

            <div class="chat-footer">
                <input type="file" id="fileInput" accept="image/*,video/*,application/*,text/*" style="display: none;">
                <button class="action-button">
                    <i class="fas fa-paperclip" id="sendFile"></i>
                </button>
                <input type="text" class="message-input" placeholder="Type a message">
                <button class="action-button">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <!-- Dialogs -->
        <!-- Add Contact Dialog -->
        <div class="dialog-overlay" id="addContactDialog">
            <div class="dialog-box">
                <h3>Add Contact</h3>
                <input type="text" class="dialog-input" placeholder="Enter User name">
                <div class="dialog-buttons">
                    <button class="dialog-button cancel" onclick="closeDialog('addContactDialog')">Cancel</button>
                    <button class="dialog-button confirm" onclick="addContact()">Add</button>
                </div>
            </div>
        </div>

        <!-- Add Stream Dialog -->
        <div class="dialog-overlay" id="addStreamDialog">
            <div class="dialog-box">
                <h3>Add Stream</h3>
                <input type="text" class="dialog-input" placeholder="Enter Stream name">
                <div class="dialog-buttons">
                    <button class="dialog-button cancel" onclick="closeDialog('addStreamDialog')">Cancel</button>
                    <button class="dialog-button confirm" onclick="createStream()">Add</button>
                </div>
            </div>
        </div>

        <!-- Status Dialog -->
        <div class="dialog-overlay" id="statusDialog">
            <div class="dialog-box">
                <h3 id="statusTitle"></h3>
                <p id="statusMessage" style="text-align: center; margin-bottom: 20px;"></p>
                <div class="dialog-buttons">
                    <button class="dialog-button confirm" onclick="closeDialog('statusDialog')">Ok</button>
                </div>
            </div>
        </div>

        <!-- Stream Management Dialog -->
        <div class="dialog-overlay" id="streamManagementDialog">
            <div class="dialog-box stream-members-dialog">
                <div class="dialog-header">
                    <h3>Stream Members</h3>
                    <button class="close-button" onclick="closeDialog('streamManagementDialog')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="members-list" id="streamMembersList">
                    <!-- Members will be populated here -->
                </div>
                <div class="add-member-icon" onclick="openAddMemberDialog()">
                    <i class="fas fa-user-plus"></i>
                    <span>Add Member</span>
                </div>
            </div>
        </div>

        <div class="dialog-overlay" id="addMemberDialog">
            <div class="dialog-box">
                <div class="dialog-header">
                    <h3>Add Contact to Stream</h3>
                    <button class="close-button" onclick="closeDialog('addMemberDialog')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <input type="text" class="dialog-input" placeholder="Enter User name">
                <div class="dialog-buttons">
                    <button class="dialog-button cancel" onclick="closeDialog('addMemberDialog')">Cancel</button>
                    <button class="dialog-button confirm" onclick="addMemberToStream()">Add</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ipfs-http-client/dist/index.min.js"></script>
    <script src="notification-worker.js"></script>
    <script src="webrtc.js"></script>
    <script>
        // State Management
        const state = {
            currentView: 'contacts',
            currentChat: null,
            currentStream: null,
            dummyContacts: [],
            dummyStreams: []
        };

        function switchTab(tab) {
            state.currentView = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.list-container').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tab}List`).classList.add('active');
            
            // Update search placeholder and add button behavior
            const searchBox = document.querySelector('.search-box');
            searchBox.placeholder = `Search ${tab.charAt(0).toUpperCase() + tab.slice(1)}`;
        }

        function handleAddButton() {
            if (state.currentView === 'contacts') {
                openDialog('addContactDialog');
            } else {
                openDialog('addStreamDialog');
            }
        }

        function openStreamManagement() {
            const membersList = document.getElementById('streamMembersList');
            membersList.innerHTML = state.dummyContacts.map(contact => `
                <div class="member-item">
                    <div class="member-avatar">${getInitials(contact.name)}</div>
                    <div class="member-info">${contact.name}</div>
                    <button class="remove-member" onclick="removeMember('${contact.name}')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
            
            openDialog('streamManagementDialog');
        }

        function openAddMemberDialog() {
            closeDialog('streamManagementDialog');
            openDialog('addMemberDialog');
        }

        function addMemberToStream() {
            const input = document.querySelector('#addMemberDialog .dialog-input');
            const username = input.value.trim();
            
            if (username) {
                // In real app, would add member to stream
                closeDialog('addMemberDialog');
                openStreamManagement(); // Reopen the members list
                showStatus('Member Added', `${username} has been added to the stream`);
                input.value = '';
            }
        }

        function removeMember(name) {
            // In real app, would remove member from stream
            showStatus('Member Removed', `${name} has been removed from the stream`);
        }
    </script>
    <script src="app.js"></script>
</body>
</html>